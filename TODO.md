# CodeMap 專案 - 狀態報告與待辦事項

**[最後更新於 2025-08-04 22:55]** 此狀態經反覆測試後再次確認。

## 🚨 **嚴重警告：開發環境問題** 🚨

**狀態：** **完全阻塞**

經過詳盡的調查，當前的開發與測試環境存在根本性問題，導致無法執行任何測試，甚至無法穩定地安裝專案依賴 (`npm install`)。所有嘗試（包括執行 `vitest` 和 `npm install`）均以超時告終。

**這不是程式碼的錯誤，而是基礎設施的問題。** 在這個環境問題得到解決之前，任何程式碼層面的修改、修復或功能開發都無法被驗證，因此無法安全地進行。

---

## 📋 待辦事項

### **第一優先級：架構改進 (在環境修復期間可進行)**

1.  **[進行中] (重構) 實現型別安全的路由系統**
    -   **目標**: 移除所有硬編碼的 URL 字串，替換為對一個集中式 `Routes` 物件的引用，以實現型別安全和易維護性。
    -   **進度**:
        -   [x] 創建 `src/lib/routes.ts` 檔案並定義了初步的路由結構。
        -   [ ] **下一步**: 在整個專案中，逐步替換硬編碼的路徑。建議從導航元件 (`navbar.tsx`, `sidebar-nav.tsx`) 開始。
        -   [ ] 審查 API 調用中的 URL，並將其也納入路由管理系統。

### **第二優先級：修復並驗證測試框架 (環境恢復後)**

這些是根據偵錯過程中的發現，必須優先處理的任務，以確保專案的穩定性。

1.  **[ ] (驗證) 移除 Vitest 配置中的 `forks` 進程池**
    -   **問題**: `vitest.config.ts` 中使用 `pool: 'forks'` 的配置，這在某些環境下可能導致進程掛起。
    -   **建議的修復**: 移除 `pool` 和 `poolOptions` 區塊，讓 Vitest 使用預設的 `threads` 模式。
    -   **驗證**: 必須確認 `npm test` 命令能夠啟動、執行並完成（無論是通過還是失敗），而不是超時。

2.  **[ ] (修復) 全面審查並重構 `vi.mock` 的使用**
    -   **問題**: 專案中大量存在 `vi.mock` 的反模式用法，其工廠函數使用了 `async` 和 `await vi.importActual`。這會導致測試執行器在啟動時掛起。
    -   **發現位置**:
        -   `src/tests/setup.ts`
        -   `src/tests/minimal.test.tsx`
        -   *可能存在於專案中其他 `*.test.tsx` 檔案中。*
    -   **建議的修復**: 將所有 `vi.mock` 的工廠函數改為同步返回。

3.  **[ ] (修復) 移除 Mock 檔案中的頂層 `await`**
    -   **問題**: 在 `src/tests/__mocks__/next/navigation.ts` 中發現了頂層 `await`，這會阻塞模組加載。
    -   **建議的修復**: 確保所有 `__mocks__` 目錄下的檔案都是完全同步的。

### **第三優先級：程式碼品質與健全性 (環境恢復後)**

1.  **[ ] (重構) 重新評估並簡化 Mock 策略**
    -   **問題**: `lucide-react` 的 mock 非常龐大且需要手動維護。
    -   **建議**: 為 `lucide-react` 創建一個更通用的 mock。

2.  **[ ] (審查) 依賴項檢查**
    -   **問題**: `package.json` 中存在大量依賴。
    -   **建議**: 運行 `npx depcheck` 和 `npm audit` 來清理和修復依賴。

### **第四優先級：功能與部署 (穩定後)**

1.  **[ ] (配置) 設置生產環境變數**
2.  **[ ] (部署) 部署前檢查**
3.  **[ ] (監控) 設置監控**
4.  **[ ] (文檔) 更新文檔**

---

**舊的 `TODO.md` 已被此文件取代，以準確反映專案的真實技術狀態。**
